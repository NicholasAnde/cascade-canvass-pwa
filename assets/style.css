:root{
  --bg:#0f1113; --card:#171a1e; --ink:#f6f7f9; --muted:#a0a6ad; --line:#2a2f36;
  --accent:#0ea5ff; --accent-ink:#001018; --btn-scale:1.6;
  --field-bg:#14171a; --safe-bottom: env(safe-area-inset-bottom, 0px);
}
:root[data-theme="light"]{
  --bg:#ffffff; --card:#f5f7fb; --ink:#0b0c0e; --muted:#50545b; --line:#d5d9e0;
  --accent:#0ea5ff; --accent-ink:#001018; --field-bg:#ffffff;
}
*{box-sizing:border-box; -webkit-tap-highlight-color: rgba(0,0,0,0);}
html,body{height:100dvh}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden; touch-action: manipulation;}
.topbar{position:fixed;top:0;left:0;right:0;height:56px;display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--card);border-bottom:1px solid var(--line);z-index:10}
.topbar h1{margin:0;font-size:1.05rem;font-weight:700;flex:1}
.iconbtn{min-width:44px;min-height:44px;border:0;background:transparent;color:var(--ink);font-size:1.2rem;border-radius:10px}
.iconbtn:hover{background:rgba(0,0,0,.08)}
.tree-emoji{display:inline-block;transform:translateY(-1px)}
.drawer{position:fixed;inset:0 35% 0 0;background:var(--card);border-right:1px solid var(--line);transform:translateX(-100%);transition:transform .2s;z-index:12}
.drawer.open{transform:translateX(0)}
.drawer header{padding:1rem;border-bottom:1px solid var(--line);font-weight:700}
.nav a{display:block;color:var(--ink);text-decoration:none;padding:1rem;border-bottom:1px solid var(--line)}
.nav a:active{background:rgba(0,0,0,.08)}
main{position:relative;padding:1rem;padding-top:calc(1rem + 56px);padding-bottom:calc(56px + var(--safe-bottom));height:calc(100dvh - 56px - 56px - var(--safe-bottom));overflow:auto;display:grid;gap:.8rem}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:.8rem .9rem}
.field{background:var(--field-bg);border:1px solid var(--line);border-radius:12px;padding:.7rem .9rem;margin:.4rem 0}
.field label{display:block;font-size:.78rem;color:var(--muted);margin-bottom:.3rem;letter-spacing:.02em;text-transform:uppercase;user-select:none}
.field input,.field select,.field textarea{width:100%;background:transparent;color:var(--ink);border:0;outline:none;font-size:1rem}
.field select{background:var(--field-bg);color:var(--ink);border-radius:10px;padding:.6rem 0}
.field option{background:var(--field-bg);color:var(--ink)}
/* Stacked buttons */
.btn-row{display:flex;flex-direction:column;gap:calc(.6rem * var(--btn-scale));}
button{background:transparent;color:var(--ink);border:1px solid var(--line);border-radius:14px;
  padding: calc(.7rem * var(--btn-scale)) calc(1rem * var(--btn-scale));
  font-size: calc(1rem * var(--btn-scale));
  min-height: calc(48px * var(--btn-scale));
  user-select:none;
}
button.primary{background:var(--accent);color:var(--accent-ink);border:0}
.foot{position:fixed;left:0;right:0;bottom:0;height:56px;display:flex;align-items:center;padding:0 1rem calc(var(--safe-bottom)/2);border-top:1px solid var(--line);background:var(--card);color:var(--muted);z-index:9}
#toast-root{position:fixed;left:0;right:0;bottom:calc(56px + var(--safe-bottom));z-index:9999;display:flex;flex-direction:column;gap:10px;pointer-events:none;padding:0 12px}
.toast{min-width:220px;max-width:520px;margin:0 auto;background:rgba(23,26,30,.96);border:1px solid var(--line);border-radius:14px;padding:.9rem 1rem;color:var(--ink);box-shadow:0 6px 20px rgba(0,0,0,.35);font-size:1rem;line-height:1.25;display:flex;align-items:flex-start;gap:.6rem;opacity:0;animation:toast-in .16s ease forwards}
.toast .close{margin-left:auto;background:transparent;border:0;color:#aab;cursor:pointer;font-size:1.2rem;line-height:1;pointer-events:auto}
@keyframes toast-in{to{opacity:1}}
.err{position:fixed;left:0;right:0;bottom:calc(56px + var(--safe-bottom));background:#7f1d1d;color:#fff;padding:.5rem 1rem;font-size:.9rem;z-index:999}
.map{height:60vh;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.pills{display:flex;gap:.5rem}
.pill{padding:.4rem .7rem;border:1px solid var(--line);border-radius:999px;cursor:pointer;user-select:none}
.pill.active{background:var(--accent);color:var(--accent-ink);border-color:transparent}

/* === v4.8 additions: rings + toasts + queue chip === */
.marker-eligible { outline: 3px solid #2ecc71; outline-offset: 2px; }
.marker-cooling  { outline: 3px solid #f1c40f; outline-offset: 2px; }
.marker-recent   { outline: 3px solid #e74c3c; outline-offset: 2px; }
.toasts{ position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
  max-width:90vw; padding:.75rem 1rem; border-radius:.75rem; background:#1b1f24;
  box-shadow:0 6px 24px rgba(0,0,0,.25); font-size:.95rem; display:none; z-index:9999 }
.toasts.show{ display:block; }
.toasts .actions{ margin-left:.75rem; text-decoration:underline; cursor:pointer; }
.queue-chip{ position:fixed; right:12px; bottom:16px; padding:.4rem .6rem;
  border-radius:999px; background:#1b1f24; border:1px solid #333; font-size:.85rem; z-index:9999 }
