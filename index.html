<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Cascade Canvass â€” PWA</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <meta name="theme-color" content="#111111"/>
  <link rel="icon" href="icons/favicon.png"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
  <header class="topbar">
    <button class="iconbtn tree" onclick="toggleDrawer()" aria-label="Menu"><span class="tree-emoji">ðŸŒ²</span></button>
    <h1>Cascade Canvass</h1>
    <button class="iconbtn" onclick="if(window.refreshGeoList) refreshGeoList()" aria-label="Reload nearby">âŸ³</button>
  </header>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <header>Menu</header>
    <nav class="nav">
      <a href="#" onclick="nav('dashboard')">Home</a>
      <a href="#" onclick="nav('knock')">Next Door</a>
      <a href="#" onclick="nav('lead')">New Lead</a>
      <a href="#" onclick="nav('tracker')">Lead Tracker</a>
      <a href="#" onclick="nav('maptoday')">Map</a>
      <a href="#" onclick="nav('scripts')">Scripts</a>
      <a href="#" onclick="nav('settings')">Settings</a>
    </nav>
  </aside>

  <main id="view"></main>

  <footer class="foot"><small>Mobile PWA</small></footer>

  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>
  <div id="err" class="err" style="display:none"></div>

  <script>
    function toggleDrawer(){
      const d=document.getElementById('drawer');
      d.classList.toggle('open'); d.setAttribute('aria-hidden', !d.classList.contains('open'));
    }
    function nav(tab){ toggleDrawer(); if(window.go) go(tab); }
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r=>r.unregister())).catch(()=>{});
    }
    window.addEventListener('error', e=>{
      const box=document.getElementById('err');
      box.style.display='block';
      box.textContent = 'JS Error: ' + (e.message || e.error || e);
    });
    document.addEventListener('DOMContentLoaded', ()=> window.go ? go('dashboard') : (document.getElementById('view').innerHTML='<section class="card"><h2>Loadingâ€¦</h2></section>'));
  </script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="assets/app.js"></script>

  <footer style="text-align:center;opacity:.7;padding:8px">Mobile PWA â€¢ v4.8.0-gps</footer>
</body>
</html>
